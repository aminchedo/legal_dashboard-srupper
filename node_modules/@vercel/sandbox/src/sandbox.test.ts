import { it, beforeEach, afterEach, expect } from "vitest";
import { consumeReadable } from "./utils/consume-readable";
import { Sandbox } from "./sandbox";

let sandbox: Sandbox;

beforeEach(async () => {
  sandbox = await Sandbox.create();
});

afterEach(async () => {
  await sandbox.stop();
});

it("allows to write files and then read them", async () => {
  await sandbox.writeFiles([
    { path: "hello1.txt", content: Buffer.from("Hello 1") },
    { path: "hello2.txt", content: Buffer.from("Hello 2") },
  ]);

  const content1 = await sandbox.readFile({ path: "hello1.txt" });
  const content2 = await sandbox.readFile({ path: "hello2.txt" });
  expect((await consumeReadable(content1!)).toString()).toBe("Hello 1");
  expect((await consumeReadable(content2!)).toString()).toBe("Hello 2");
});
