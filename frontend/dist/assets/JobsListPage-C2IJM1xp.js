var O=Object.defineProperty;var z=(l,s,a)=>s in l?O(l,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[s]=a;var T=(l,s,a)=>z(l,typeof s!="symbol"?s+"":s,a);import{u as F,r as p,j as e}from"./index-CsDVfZsh.js";const w={},J=(w==null?void 0:w.VITE_API_URL)||"http://localhost:3000/api";async function y(l,s){const a=await fetch(`${J}${l}`,s);if(!a.ok){const r=await a.text().catch(()=>"");throw new Error(`API ${l} failed: ${a.status} ${r}`)}return a.json()}const U={async addOrUpdateProxy(l){await y("/proxy/upsert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})},async addProxyTestResult(l){await y("/proxy/test-result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})},async listProxyTestResults(l=100){return y(`/proxy/test-results?limit=${l}`)},async updateSiteLastScraped(l){await y("/scraping/site-last-scraped",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:l})})}},S="http://localhost:3000/api";function v(){const l=localStorage.getItem("accessToken");return l?{Authorization:`Bearer ${l}`}:{}}async function B(l,s,a){const r=await fetch(`${S}/scraping/start`,{method:"POST",headers:{"Content-Type":"application/json",...v()},body:JSON.stringify({url:l,sourceId:s,depth:a})});if(!r.ok)throw new Error("Failed to start scraping");return r.json()}async function M(l=20){const s=await fetch(`${S}/documents?limit=${l}`,{headers:{...v()}});if(!s.ok)throw new Error("Failed to list documents");return(await s.json()).items||[]}async function D(l){const s=await fetch(`${S}/scraping/status/${l}`,{headers:{...v()}});if(!s.ok)throw new Error("Failed to fetch job status");return s.json()}class q{constructor(){T(this,"scrapedUrls",new Set)}async scrapeSite(s,a,r){try{r==null||r(0,`شروع اسکرپ از ${s.name}`);const{jobId:c}=await B(s.url,String(s.id),a.maxPages);let d=!1;for(;!d;){await this.delay(1e3);const n=await D(c),x=typeof n.progress=="number"?n.progress:0;if(r==null||r(x,n.status||"در حال پردازش"),(n.status==="completed"||x>=100)&&(d=!0),n.status==="failed")throw new Error(n.error||"اسکرپ ناموفق بود")}return r==null||r(100,`تکمیل اسکرپ از ${s.name}`),await U.updateSiteLastScraped(s.url),(await M(Math.max(5,Math.min(50,a.maxPages)))).map(n=>{var h;const x=((h=n.metadata)==null?void 0:h.url)||s.url,o=(()=>{try{return new URL(x).hostname}catch{return new URL(s.url).hostname}})();return{id:n.id,url:x,title:n.title,content:n.content,domain:o,category:n.category||"نامشخص",ratingScore:0,wordCount:typeof n.content=="string"?n.content.split(/\s+/).length:0,createdAt:new Date(n.created_at),status:"completed"}})}catch(c){throw console.error(`خطا در اسکرپ ${s.url}:`,c),c}}generateSampleContent(s){const a={دادگستری:[{title:"آیین‌نامه اجرایی دادگاه‌های عمومی",content:"ماده ۱ - دادگاه‌های عمومی در شهرستان‌ها تأسیس و طبق قانون آیین دادرسی مدنی رسیدگی به دعاوی خواهند کرد. ماده ۲ - صلاحیت دادگاه‌ها در رسیدگی به امور مدنی و جزایی بر اساس قوانین مربوطه تعیین می‌شود.",slug:"civil-court-procedures"},{title:"رویه قضایی در امور خانوادگی",content:"دادگاه‌های خانواده مکلف به رسیدگی سریع و عادلانه در امور ازدواج، طلاق، نفقه و حضانت فرزندان هستند. قضات باید با درنظرگیری مصالح خانواده و فرزندان تصمیم‌گیری نمایند.",slug:"family-court-procedures"}],قانون:[{title:"قانون مدنی - کتاب اول: اشخاص",content:"اصل ۱ - هر کس از لحظه تولد تا هنگام مرگ دارای شخصیت حقوقی است. اصل ۲ - اهلیت هر شخص تابع قانون کشوری است که تابعیت او را دارد. اصل ۳ - محل اقامت شخص جایی است که او قصد اقامت دائم در آن را داشته باشد.",slug:"civil-law-persons"},{title:"قانون تجارت - شرکت‌های تجاری",content:"ماده ۱ - شرکت‌های تجاری عبارتند از: شرکت تضامنی، شرکت مختلط غیر سهامی، شرکت مختلط سهامی، شرکت مسئولیت محدود و شرکت سهامی. ماده ۲ - تأسیس شرکت‌ها مستلزم ثبت در اداره ثبت شرکت‌ها است.",slug:"commercial-companies"}],وکالت:[{title:"ضوابط اخلاقی وکلای دادگستری",content:"وکیل دادگستری باید در انجام وظایف خود صادق، امین و متعهد باشد. او نباید پرونده‌هایی را که تعارض منافع دارند همزمان پذیرد. وکیل موظف است اطلاعات محرمانه موکل را حفظ کند.",slug:"lawyer-ethics-code"},{title:"تعرفه حق‌الوکاله سال ۱۴۰۳",content:"حق‌الوکاله وکلای دادگستری بر اساس تعرفه مصوب کانون وکلای دادگستری تعیین می‌شود. این تعرفه ساليانه بازنگری و به‌روزرسانی می‌شود. وکلا موظف به رعایت سقف تعیین شده هستند.",slug:"lawyer-fees-2024"}]},r=a[s.category]||a.قانون,c=[...r];for(let d=0;d<5;d++){const u=d%r.length,g=r[u];c.push({title:`${g.title} - بخش ${d+2}`,content:`${g.content} 

بند اضافی: این بخش حاوی توضیحات تکمیلی و جزئیات بیشتری از قوانین و مقررات مربوطه می‌باشد که جهت اطلاع و استفاده متقاضیان ارائه می‌شود.`,slug:`${g.slug}-section-${d+2}`})}return c}generateId(s){let a=0;for(let r=0;r<s.length;r++){const c=s.charCodeAt(r);a=(a<<5)-a+c,a=a&a}return Math.abs(a).toString(36)}delay(s){return new Promise(a=>setTimeout(a,s))}}const G=new q;function W(){const{data:l}=F(),s=((l==null?void 0:l.sources)||[]).map((t,i)=>({id:i+1,name:t.name,url:t.url||t.base_url,category:t.category||"نامشخص",active:t.status!=="inactive"})),[a,r]=p.useState([]),[c,d]=p.useState({maxPages:10,delay:2,minContentLength:100,enableRating:!0}),[u,g]=p.useState(!1),[n,x]=p.useState(null),[o,h]=p.useState([]),[I,j]=p.useState(!1),R=t=>{r(i=>i.includes(t)?i.filter(b=>b!==t):[...i,t])},A=async()=>{var b;if(!s||a.length===0)return;g(!0),j(!1),h([]);const t=s.filter(m=>a.includes(m.id)),i=[];try{for(let m=0;m<t.length;m++){const f=t[m];x({siteIndex:m,totalSites:t.length,currentSite:f.name,progress:0,status:`شروع اسکرپ از ${f.name}`});const C=await G.scrapeSite(f,c,(N,P)=>{x(k=>k?{...k,progress:N,status:P}:null)});i.push(...C),x({siteIndex:m+1,totalSites:t.length,currentSite:m<t.length-1?((b=t[m+1])==null?void 0:b.name)??"":"",progress:100,status:`تکمیل شد - ${C.length} آیتم جمع‌آوری شد`}),m<t.length-1&&await new Promise(N=>setTimeout(N,1e3))}h(i),j(!0)}catch(m){console.error("Scraping error:",m)}finally{g(!1),x(null)}},L=()=>{g(!1),x(null)},E=()=>{h([]),j(!1)};if(!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"در حال بارگذاری منابع..."})]})});const $=n?n.siteIndex/n.totalSites*100+n.progress/n.totalSites:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"وب اسکرپینگ هوشمند"}),e.jsx("p",{className:"text-gray-600",children:"جمع‌آوری خودکار اطلاعات از منابع حقوقی معتبر"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"انتخاب منابع"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(t=>e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.includes(t.id),onChange:()=>R(t.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded ml-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.category})]})]},t.id))}),a.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx(Globe,{className:"inline ml-2",size:16}),a.length," منبع انتخاب شده"]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[e.jsx(Settings,{className:"inline ml-2",size:20}),"تنظیمات"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["حداکثر صفحات هر منبع: ",c.maxPages]}),e.jsx("input",{type:"range",min:"1",max:"50",value:c.maxPages,onChange:t=>d(i=>({...i,maxPages:parseInt(t.target.value)})),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",disabled:u})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["تاخیر بین درخواست‌ها: ",c.delay," ثانیه"]}),e.jsx("input",{type:"range",min:"1",max:"10",value:c.delay,onChange:t=>d(i=>({...i,delay:parseInt(t.target.value)})),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",disabled:u})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["حداقل طول محتوا: ",c.minContentLength]}),e.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:c.minContentLength,onChange:t=>d(i=>({...i,minContentLength:parseInt(t.target.value)})),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",disabled:u})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.enableRating,onChange:t=>d(i=>({...i,enableRating:t.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded ml-3",disabled:u}),e.jsx("span",{className:"text-sm text-gray-700",children:"رتبه‌بندی هوشمند محتوا"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"وضعیت"}),u?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 mb-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-600 ml-2"}),"در حال اسکرپ..."]}),n&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:n.currentSite}),e.jsx("p",{className:"text-xs text-gray-500",children:n.status})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${$}%`}})}),e.jsxs("p",{className:"text-xs text-gray-600",children:[$.toFixed(1),"% تکمیل شده"]})]})]}):I?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 mb-4",children:"✅ تکمیل شده"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[o.length," آیتم جمع‌آوری شد"]})]}):e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:"⏸️ آماده"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:A,disabled:a.length===0||u,className:"w-full flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors",children:[e.jsx(Play,{size:20}),"شروع اسکرپینگ"]}),e.jsxs("button",{onClick:L,disabled:!u,className:"w-full flex items-center justify-center gap-2 bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors",children:[e.jsx(Square,{size:20}),"توقف اسکرپینگ"]}),e.jsxs("button",{onClick:E,disabled:o.length===0,className:"w-full flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors",children:[e.jsx(Trash2,{size:20}),"پاک کردن نتایج"]})]})})]})]}),o.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"نتایج اسکرپینگ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"کل آیتم‌ها"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:new Set(o.map(t=>t.category)).size}),e.jsx("div",{className:"text-sm text-green-700",children:"دسته‌بندی"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-600",children:[(o.reduce((t,i)=>t+i.ratingScore,0)/o.length*100).toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-yellow-700",children:"رتبه میانگین"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"نمونه آیتم‌های جمع‌آوری شده:"}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:o.slice(0,10).map((t,i)=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:t.domain}),e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs",children:t.category}),e.jsxs("span",{children:["⭐ ",(t.ratingScore*100).toFixed(0),"%"]})]})]})},t.id))}),o.length>10&&e.jsxs("p",{className:"text-sm text-gray-500 mt-3 text-center",children:["و ",o.length-10," مورد دیگر..."]})]})]}),a.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(AlertCircle,{size:20}),e.jsx("span",{className:"font-medium",children:"لطفاً حداقل یک منبع را انتخاب کنید"})]})})]})}export{W as default};
