import{r as u,I as O,g as B,c as M,j as e}from"./index-DFIyXlnM.js";import{u as T}from"./useMutation-B-WHVmSL.js";import{d as L}from"./database-qJYvHaQU.js";var W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},z.apply(this,arguments)}const G=(t,s)=>u.createElement(O,z({},t,{ref:s,icon:W})),Y=u.forwardRef(G);var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"};function q(){return q=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},q.apply(this,arguments)}const ee=(t,s)=>u.createElement(O,q({},t,{ref:s,icon:Z})),te=u.forwardRef(ee);var se={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"};function E(){return E=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},E.apply(this,arguments)}const re=(t,s)=>u.createElement(O,E({},t,{ref:s,icon:se})),ae=u.forwardRef(re);var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},F.apply(this,arguments)}const le=(t,s)=>u.createElement(O,F({},t,{ref:s,icon:ne})),ie=u.forwardRef(le);var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};function A(){return A=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},A.apply(this,arguments)}const ce=(t,s)=>u.createElement(O,A({},t,{ref:s,icon:oe})),de=u.forwardRef(ce),I={},C=(I==null?void 0:I.VITE_API_URL)||"http://localhost:3000/api";function ue(t){return B({queryKey:["proxies",t],queryFn:async()=>{const s=new URL(`${C}/proxy/list`);t.query&&s.searchParams.set("q",t.query);const a=await fetch(s.toString());return a.ok?a.json():[]},initialData:[]})}function xe(){const t=M();return T({mutationFn:async s=>{if(!(await fetch(`${C}/proxy/upsert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to upsert proxy")},onSuccess:()=>t.invalidateQueries({queryKey:["proxies"]})})}function me(){const t=M();return T({mutationFn:async s=>{if(!(await fetch(`${C}/proxy/${encodeURIComponent(s)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete proxy")},onSuccess:()=>t.invalidateQueries({queryKey:["proxies"]})})}function he(){const t=M();return T({mutationFn:async s=>{if(!(await fetch(`${C}/proxy/import`,{method:"POST",headers:{"Content-Type":"text/plain"},body:s})).ok)throw new Error("Failed to import proxies")},onSuccess:()=>t.invalidateQueries({queryKey:["proxies"]})})}function ge(){return B({queryKey:["proxyRotationSettings"],queryFn:async()=>{const t=await fetch(`${C}/proxy/rotation-settings`);return t.ok?t.json():{strategy:"sequential",intervalSeconds:0,requestsPerProxy:10,failureThreshold:3,stickySessionSeconds:0,siteSpecificAssignments:{},geoRestrictions:{}}}})}function pe(){const t=M();return T({mutationFn:async s=>{if(!(await fetch(`${C}/proxy/rotation-settings`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to save rotation settings")},onSuccess:()=>t.invalidateQueries({queryKey:["proxyRotationSettings"]})})}function ye({isLoading:t,items:s,selected:a,onSelectedChange:i,onEdit:l,onFiltersChange:x,allCountries:g}){const[r,d]=u.useState([]),[o,N]=u.useState([]),[m,w]=u.useState([]),h=n=>{i(a.includes(n)?a.filter(y=>y!==n):[...a,n])},b=()=>{a.length===s.length?i([]):i(s.map(n=>n.id))},p=u.useMemo(()=>s,[s]),v=n=>{const y=n.status??r,$=n.types??o,k=n.countries??m;d(y),N($),w(k),x({status:y,types:$,countries:k})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"وضعیت:"}),["online","offline","testing","unknown"].map(n=>e.jsx("button",{onClick:()=>v({status:r.includes(n)?r.filter(y=>y!==n):[...r,n]}),className:`px-2.5 py-1 rounded-md text-sm border ${r.includes(n)?"bg-blue-50 border-blue-200 text-blue-700":"border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:n==="online"?"آنلاین":n==="offline"?"آفلاین":n==="testing"?"درحال تست":"نامشخص"},n))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"نوع:"}),["HTTP","HTTPS","SOCKS4","SOCKS5"].map(n=>e.jsx("button",{onClick:()=>v({types:o.includes(n)?o.filter(y=>y!==n):[...o,n]}),className:`px-2.5 py-1 rounded-md text-sm border ${o.includes(n)?"bg-blue-50 border-blue-200 text-blue-700":"border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:n},n))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"کشور:"}),e.jsx("select",{multiple:!0,value:m,onChange:n=>v({countries:Array.from(n.target.selectedOptions).map(y=>y.value)}),className:"min-w-[160px] max-w-[240px] px-2 py-1 border border-gray-200 rounded-md",children:g.map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"p-3 text-right",children:e.jsx("input",{type:"checkbox",checked:a.length===p.length&&p.length>0,onChange:b})}),e.jsx("th",{className:"p-3 text-right",children:"IP"}),e.jsx("th",{className:"p-3 text-right",children:"پرت"}),e.jsx("th",{className:"p-3 text-right",children:"نوع"}),e.jsx("th",{className:"p-3 text-right",children:"وضعیت"}),e.jsx("th",{className:"p-3 text-right",children:"تأخیر"}),e.jsx("th",{className:"p-3 text-right",children:"آخرین تست"}),e.jsx("th",{className:"p-3 text-right",children:"کشور"}),e.jsx("th",{className:"p-3 text-right",children:"برچسب‌ها"}),e.jsx("th",{className:"p-3 text-right",children:"عملیات"})]})}),e.jsx("tbody",{children:t?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-6 text-center text-gray-500",children:"در حال بارگذاری..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"p-10 text-center text-gray-500",children:"موردی یافت نشد"})}):p.map(n=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"checkbox",checked:a.includes(n.id),onChange:()=>h(n.id)})}),e.jsx("td",{className:"p-3 font-mono text-sm",children:n.ip}),e.jsx("td",{className:"p-3",children:n.port}),e.jsx("td",{className:"p-3",children:n.type}),e.jsxs("td",{className:"p-3",children:[n.status==="online"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-700",children:[e.jsx(Y,{})," آنلاین"]}),n.status==="offline"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-700",children:[e.jsx(ae,{})," آفلاین"]}),n.status==="testing"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-yellow-700",children:[e.jsx(te,{})," درحال تست"]}),n.status==="unknown"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-600",children:[e.jsx(de,{})," نامشخص"]})]}),e.jsx("td",{className:"p-3",children:n.lastLatencyMs?`${n.lastLatencyMs} ms`:"-"}),e.jsx("td",{className:"p-3",children:n.lastTestedAt?new Date(n.lastTestedAt).toLocaleString("fa-IR"):"-"}),e.jsx("td",{className:"p-3",children:n.country||"-"}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(n.labels||[]).map(y=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-50 text-blue-700 rounded",children:y},y))})}),e.jsx("td",{className:"p-3",children:e.jsxs("button",{onClick:()=>l(n),className:"text-blue-600 hover:text-blue-700 inline-flex items-center gap-1",children:[e.jsx(ie,{})," ویرایش"]})})]},n.id))})]})})]})}function be({open:t,onOpenChange:s,initial:a,onSubmit:i}){const[l,x]=u.useState({ip:"",port:8080,type:"HTTP",labels:[],timeoutMs:5e3,anonymity:"unknown"});if(u.useEffect(()=>{if(a){const{id:r,status:d,...o}=a;x({ip:o.ip,port:o.port,type:o.type,...o.username?{username:o.username}:{},...o.password?{password:o.password}:{},...o.country?{country:o.country}:{},...o.region?{region:o.region}:{},labels:o.labels||[],...o.timeoutMs?{timeoutMs:o.timeoutMs}:{},...o.lastLatencyMs?{lastLatencyMs:o.lastLatencyMs}:{},...o.lastTestedAt?{lastTestedAt:o.lastTestedAt}:{},anonymity:o.anonymity||"unknown"})}},[a]),!t)return null;const g=async r=>{if(r.preventDefault(),!l.ip||!/^\d{1,3}(?:\.\d{1,3}){3}$/.test(l.ip))return alert("IP معتبر وارد کنید");if(!l.port||l.port<1||l.port>65535)return alert("پرت معتبر نیست");await i(l)};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a?"ویرایش پروکسی":"افزودن پروکسی"}),e.jsx("button",{onClick:()=>s(!1),"aria-label":"Close",children:e.jsx(X,{})})]}),e.jsxs("form",{onSubmit:g,className:"p-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"IP"}),e.jsx("input",{value:l.ip,onChange:r=>x(d=>({...d,ip:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"پرت"}),e.jsx("input",{type:"number",value:l.port,onChange:r=>x(d=>({...d,port:parseInt(r.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",min:1,max:65535,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نوع"}),e.jsx("select",{value:l.type,onChange:r=>x(d=>({...d,type:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:["HTTP","HTTPS","SOCKS4","SOCKS5"].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"نام کاربری"}),e.jsx("input",{value:l.username||"",onChange:r=>x(d=>({...d,username:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"گذرواژه"}),e.jsx("input",{type:"password",value:l.password||"",onChange:r=>x(d=>({...d,password:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"کشور"}),e.jsx("input",{value:l.country||"",onChange:r=>x(d=>({...d,country:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"استان/منطقه"}),e.jsx("input",{value:l.region||"",onChange:r=>x(d=>({...d,region:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"برچسب‌ها (با , از هم جدا کنید)"}),e.jsx("input",{value:(l.labels||[]).join(","),onChange:r=>x(d=>({...d,labels:r.target.value.split(",").map(o=>o.trim()).filter(Boolean)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Timeout (ms)"}),e.jsx("input",{type:"number",value:l.timeoutMs??5e3,min:1e3,max:6e4,onChange:r=>x(d=>({...d,timeoutMs:parseInt(r.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-3 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 rounded-lg border border-gray-300",children:"انصراف"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"ذخیره"})]})]})]})})}const je="http://localhost:3000/api";async function fe(t,s,a){const i=t.username||t.password?`${t.type.toLowerCase()}://${encodeURIComponent(t.username||"")}:${encodeURIComponent(t.password||"")}@${t.ip}:${t.port}`:`${t.type.toLowerCase()}://${t.ip}:${t.port}`,x=await(await fetch(`${je}/proxy/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proxy:i,testUrl:s,timeoutMs:t.timeoutMs??8e3})})).json();return{success:!!x.success,latency:Math.round(x.latencyMs||0),statusCode:x.statusCode,errorMessage:x.error}}function ve({items:t,onAfterTest:s}){const[a,i]=u.useState("https://httpbin.org/status/204"),[l,x]=u.useState(5),[g,r]=u.useState(!1),[d,o]=u.useState(0),N=async()=>{if(g||t.length===0)return;r(!0),o(0);const m=new AbortController;let w=0;const h=[...t],b=new Array(Math.min(l,t.length)).fill(null).map(async()=>{for(;h.length;){const p=h.shift();await L.addOrUpdateProxy({...p,status:"testing"});const v=await fe(p,a,m.signal);await L.addProxyTestResult({id:`${p.id}-${Date.now()}`,proxyId:p.id,testedAt:new Date,success:v.success,latencyMs:v.latency,statusCode:v.statusCode??0,errorMessage:v.errorMessage??"",testUrl:a}),w++,o(Math.round(w/t.length*100))}});await Promise.all(b),r(!1),s==null||s()};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 inline-flex items-center gap-2",children:[e.jsx(Activity,{size:16})," تست گروهی پروکسی"]}),g?e.jsxs("span",{className:"text-xs text-blue-700 inline-flex items-center gap-1",children:[e.jsx(Loader2,{className:"animate-spin",size:14})," درحال تست (",d,"%)"]}):null]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"آدرس تست"}),e.jsx("input",{value:a,onChange:m=>i(m.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"همزمانی"}),e.jsx("input",{type:"number",min:1,max:20,value:l,onChange:m=>x(parseInt(m.target.value)),className:"w-24 px-3 py-2 border border-gray-300 rounded-lg"}),e.jsxs("button",{disabled:g||t.length===0,onClick:N,className:"ml-auto inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:[e.jsx(PlayCircle,{size:16})," تست همه"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:d+"%"}})})]})]})}function Ne(){const{data:t}=ge(),s=pe(),[a,i]=u.useState(null),l=a||t,x=r=>{i(d=>({...d||t,...r}))},g=async()=>{l&&(await s.mutateAsync(l),i(null))};return l?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 inline-flex items-center gap-2",children:[e.jsx(RotateCw,{size:16})," تنظیمات چرخش پروکسی"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"استراتژی"}),e.jsxs("select",{value:l.strategy,onChange:r=>x({strategy:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"sequential",children:"Sequential"}),e.jsx("option",{value:"random",children:"Random"}),e.jsx("option",{value:"roundrobin",children:"Round-robin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"فاصله زمانی (ثانیه)"}),e.jsx("input",{type:"number",min:0,value:l.intervalSeconds,onChange:r=>x({intervalSeconds:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"تعداد درخواست به ازای هر پروکسی"}),e.jsx("input",{type:"number",min:1,value:l.requestsPerProxy,onChange:r=>x({requestsPerProxy:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"آستانه خطا"}),e.jsx("input",{type:"number",min:1,value:l.failureThreshold,onChange:r=>x({failureThreshold:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"مدت نشست چسبنده (ثانیه)"}),e.jsx("input",{type:"number",min:0,value:l.stickySessionSeconds,onChange:r=>x({stickySessionSeconds:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"ذخیره تنظیمات"})})]})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 text-sm text-gray-500",children:"در حال بارگذاری تنظیمات چرخش..."})}function we(){const[t,s]=u.useState(null),[a,i]=u.useState(!1);return u.useEffect(()=>{let l=!0;const x=async()=>{i(!0);try{const r=await L.listProxyTestResults(100);if(!l)return;const d=r.length,o=r.filter(h=>h.success).length,N=d?Math.round(o/d*100):0,m=r.filter(h=>h.success).map(h=>h.latencyMs),w=m.length?Math.round(m.reduce((h,b)=>h+b,0)/m.length):0;s({total:d,successRate:N,avgLatency:w,lastTests:r.slice(0,5)})}finally{l&&i(!1)}};x();const g=setInterval(x,5e3);return()=>{l=!1,clearInterval(g)}},[]),a&&!t?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 text-sm text-gray-500",children:"در حال بارگذاری تحلیل..."}):t?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 inline-flex items-center gap-2",children:[e.jsx(BarChart3,{size:16})," تحلیل عملکرد پروکسی"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"کل تست‌ها"}),e.jsx("div",{className:"text-lg font-semibold",children:t.total.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"نرخ موفقیت"}),e.jsxs("div",{className:"text-lg font-semibold",children:[t.successRate,"%"]})]}),e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"میانگین تاخیر"}),e.jsxs("div",{className:"text-lg font-semibold",children:[t.avgLatency," ms"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"آخرین نتایج"}),e.jsx("div",{className:"space-y-2",children:t.lastTests.map(l=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"truncate max-w-[50%] text-gray-700",children:l.proxyId}),e.jsx("div",{className:l.success?"text-green-700":"text-red-700",children:l.success?"موفق":"ناموفق"}),e.jsxs("div",{className:"text-gray-600",children:[l.latencyMs," ms"]}),e.jsx("div",{className:"text-gray-500 truncate max-w-[30%]",children:l.statusCode||l.errorMessage||""})]},l.id))})]})]}):e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 text-sm text-gray-500",children:"داده‌ای برای تحلیل وجود ندارد"})}function Oe(){const[t,s]=u.useState(""),[a,i]=u.useState([]),[l,x]=u.useState([]),[g,r]=u.useState([]),[d,o]=u.useState([]),[N,m]=u.useState(!1),[w,h]=u.useState(null),{data:b,refetch:p,isLoading:v}=ue({query:t,status:a,types:l,countries:g}),n=xe(),y=me(),$=he(),k=u.useMemo(()=>Array.from(new Set((b||[]).map(c=>c.country).filter(Boolean))),[b]),D=()=>{h(null),m(!0)},K=c=>{h(c),m(!0)},H=async()=>{for(const c of d)await y.mutateAsync(c);o([]),p()},Q=async c=>{const j=await c.text();await $.mutateAsync(j),p()},J=async c=>{const j=c.ip&&c.port?`${c.ip}:${c.port}`:`proxy-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;await n.mutateAsync({id:j,ip:c.ip,port:c.port,type:c.type,username:c.username??"",password:c.password??"",country:c.country??"",region:c.region??"",labels:c.labels||[],timeoutMs:c.timeoutMs??5e3,status:c.status||"unknown",lastLatencyMs:c.lastLatencyMs??0,lastTestedAt:c.lastTestedAt??new Date,anonymity:c.anonymity??"unknown"}),m(!1),h(null),p()},R=async c=>{const j=(b||[]).filter(f=>(!t||`${f.ip}:${f.port}`.includes(t))&&(!a.length||a.includes(f.status))&&(!l.length||l.includes(f.type))&&(!g.length||f.country&&g.includes(f.country))),S=c==="json"?JSON.stringify(j,null,2):j.map(f=>`${f.ip}:${f.port}${f.country?`,${f.country}`:""}`).join(`
`),V=new Blob([S],{type:c==="json"?"application/json":"text/plain;charset=utf-8"}),U=URL.createObjectURL(V),P=document.createElement("a");P.href=U;const _=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");P.download=`proxies_${_}.${c}`,document.body.appendChild(P),P.click(),P.remove(),URL.revokeObjectURL(U)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"مدیریت پروکسی"}),e.jsx("p",{className:"text-gray-600",children:"پیکربندی، تست و چرخش پروکسی‌ها با پشتیبانی کامل"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[240px]",children:[e.jsx(Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),e.jsx("input",{value:t,onChange:c=>s(c.target.value),placeholder:"جستجو (IP، کشور، برچسب)",className:"w-full pr-9 pl-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:D,className:"inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2.5 rounded-lg hover:bg-blue-700",children:[e.jsx(Plus,{size:18})," افزودن پروکسی"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-blue-700 hover:text-blue-800",children:[e.jsx(Upload,{size:18}),e.jsx("span",{children:"ورود گروهی"}),e.jsx("input",{type:"file",accept:".txt,.csv",className:"hidden",onChange:c=>{var S;const j=(S=c.target.files)==null?void 0:S[0];j&&Q(j)}})]}),e.jsxs("button",{onClick:()=>p(),className:"inline-flex items-center gap-2 text-gray-700 hover:text-gray-900",children:[e.jsx(RefreshCw,{size:18})," بروزرسانی"]}),e.jsxs("div",{className:"relative inline-flex items-center gap-2 ml-auto",children:[e.jsx(Download,{size:18,className:"text-gray-700"}),e.jsx("button",{onClick:()=>R("csv"),className:"text-sm px-2 py-1 rounded border border-gray-200 hover:bg-gray-50",children:"CSV"}),e.jsx("button",{onClick:()=>R("txt"),className:"text-sm px-2 py-1 rounded border border-gray-200 hover:bg-gray-50",children:"TXT"}),e.jsx("button",{onClick:()=>R("json"),className:"text-sm px-2 py-1 rounded border border-gray-200 hover:bg-gray-50",children:"JSON"})]}),e.jsxs("button",{disabled:!d.length,onClick:H,className:"text-red-600 hover:text-red-700 disabled:text-gray-300",children:["حذف انتخاب‌شده‌ها (",d.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx(ye,{isLoading:v,items:b||[],selected:d,onSelectedChange:o,onEdit:K,onFiltersChange:({status:c,types:j,countries:S})=>{i(c),x(j),r(S)},allCountries:k})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ve,{items:b||[],onAfterTest:()=>p()}),e.jsx(Ne,{}),e.jsx(we,{})]})]}),N&&e.jsx(be,{open:N,onOpenChange:m,initial:w,onSubmit:J})]})}export{Oe as default};
